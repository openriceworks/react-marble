"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useContext = void 0;
const pipeable_1 = require("fp-ts/lib/pipeable");
const function_1 = require("fp-ts/lib/function");
const O = require("fp-ts/lib/Option");
const error_model_1 = require("../error/error.model");
const error_factory_1 = require("../error/error.factory");
const coreErrorOptions = { contextMethod: 'useContext', offset: 2 };
const useContext = (token) => (ask) => (0, pipeable_1.pipe)(ask(token), O.fold(() => {
    const message = `Cannot resolve "${token.name || token._id}" context token.`;
    const detail = `You've probably forgot to register the bound token in the app context.`;
    const error = new error_model_1.ContextError(`${message} ${detail}`);
    const coreError = (0, error_factory_1.coreErrorFactory)(error.message, coreErrorOptions);
    console.error(coreError.stack);
    throw error;
}, function_1.identity));
exports.useContext = useContext;
