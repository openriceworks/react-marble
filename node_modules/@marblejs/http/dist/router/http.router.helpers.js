"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.decorateMiddleware = exports.decorateEffect = exports.isRouteCombinerConfig = exports.isRouteEffectGroup = void 0;
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const utils_1 = require("@marblejs/core/dist/+internal/utils");
const isRouteEffectGroup = (item) => Array.isArray(item.effects) &&
    Array.isArray(item.middlewares);
exports.isRouteEffectGroup = isRouteEffectGroup;
const isRouteCombinerConfig = (item) => Array.isArray(item.effects);
exports.isRouteCombinerConfig = isRouteCombinerConfig;
const decorateEffect = (stream, errorSubject) => {
    stream.pipe = (...operations) => (0, rxjs_1.pipe)((0, operators_1.mergeMap)((request) => (0, utils_1.pipeFromArray)([
        ...operations,
        (0, operators_1.map)((res) => (Object.assign(Object.assign({}, res), { request }))),
        (0, operators_1.catchError)((error) => {
            errorSubject.next({ error, request });
            return rxjs_1.EMPTY;
        }),
    ])((0, rxjs_1.of)(request))))(stream);
    return stream;
};
exports.decorateEffect = decorateEffect;
const decorateMiddleware = (stream, errorSubject) => {
    stream.pipe = (...operations) => (0, rxjs_1.pipe)((0, operators_1.mergeMap)((request) => (0, utils_1.pipeFromArray)([
        ...operations,
        (0, operators_1.catchError)((error) => {
            errorSubject.next({ error, request });
            return rxjs_1.EMPTY;
        }),
    ])((0, rxjs_1.of)(request))))(stream);
    return stream;
};
exports.decorateMiddleware = decorateMiddleware;
