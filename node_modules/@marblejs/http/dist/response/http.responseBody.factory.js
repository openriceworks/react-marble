"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.factorizeBody = void 0;
const function_1 = require("fp-ts/lib/function");
const utils_1 = require("@marblejs/core/dist/+internal/utils");
const contentType_util_1 = require("../+internal/contentType.util");
const urlEncoded_util_1 = require("../+internal/urlEncoded.util");
const factorizeBody = ({ headers, body }) => {
    const contentType = (0, contentType_util_1.getContentTypeUnsafe)(headers);
    if ((0, utils_1.isStream)(body))
        return body;
    if ((0, contentType_util_1.isJsonContentType)(contentType))
        return (0, utils_1.stringifyJson)(body);
    switch (contentType) {
        case contentType_util_1.ContentType.APPLICATION_X_WWW_FORM_URLENCODED:
            return (0, urlEncoded_util_1.transformUrlEncoded)(body);
        case contentType_util_1.ContentType.APPLICATION_OCTET_STREAM:
            return !Buffer.isBuffer(body)
                ? (0, function_1.pipe)(body, utils_1.stringifyJson, utils_1.bufferFrom)
                : body;
        case contentType_util_1.ContentType.TEXT_PLAIN:
            return String(body);
        default:
            return body;
    }
};
exports.factorizeBody = factorizeBody;
